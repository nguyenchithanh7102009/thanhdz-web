<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hình đại diện | CoinVid Clone</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> 
    <style>
        /* CSS Riêng cho trang Chọn Avatar */
        
        body {
            background-color: #0d1117; 
            padding-bottom: 100px; /* Dành chỗ cho nút xác nhận */
        }

        /* Header cố định */
        .avatar-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #161b22;
            border-bottom: 1px solid #2d3840;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .avatar-header .back-arrow {
            color: #e6edf3;
            font-size: 1.5rem;
            margin-right: 20px;
            cursor: pointer;
        }
        .avatar-header h2 {
            margin: 0;
            font-size: 18px;
            color: #e6edf3;
            font-weight: 600;
        }
        
        /* Lưới chọn Avatar */
        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 cột như hình */
            gap: 15px 5px; /* Khoảng cách giữa các ảnh */
            padding: 20px 10px;
        }
        .avatar-option {
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
            padding: 5px;
            border-radius: 50%;
            border: 3px solid transparent;
        }
        .avatar-option img {
            width: 90%;
            height: 90%;
            object-fit: cover;
            border-radius: 50%;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .avatar-option:hover img {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        /* Hiệu ứng chọn (Active) */
        .avatar-option.selected {
            border: 3px solid #FFD700; /* Viền vàng khi được chọn */
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }

        /* Nút Xác nhận */
        .confirm-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            background-color: #161b22;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
            text-align: center;
            z-index: 20;
        }
        .confirm-bar button {
            background: linear-gradient(90deg, #FFD700, #FFA500);
            color: #161b22;
            padding: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 95%;
            font-weight: bold;
            font-size: 17px;
            transition: opacity 0.2s;
        }
        .confirm-bar button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    
    <div class="avatar-header">
        <i class="fas fa-arrow-left back-arrow" onclick="window.history.back()"></i>
        <h2>Hình đại diện</h2>
    </div>

    <div class="avatar-grid" id="avatar-grid">
        </div>
    
    <div class="confirm-bar">
        <button id="confirm-btn" disabled>Chắc chắn rồi</button>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', initializeAvatarSelection);

        const API_BASE_URL = 'http://localhost:3000/api'; 
        let selectedAvatarUrl = null;
        
        // Danh sách các ID/Seed để tạo avatar độc đáo (50 tùy chọn)
        // Đã chuyển sang Robohash để tăng khả năng tải thành công
        const avatarSeeds = Array.from({ length: 50 }, (_, i) => `user-${i}-${Math.random()}`);

        function initializeAvatarSelection() {
            const grid = document.getElementById('avatar-grid');
            const confirmBtn = document.getElementById('confirm-btn');

            avatarSeeds.forEach(seed => {
                // SỬ DỤNG ROBO-HASH (thường ít bị chặn hơn)
                // Style: Rô bốt (set=set1), Quái vật (set=set2)
                const avatarUrl = `https://robohash.org/${seed}.png?size=100x100&set=set2`; 

                const optionDiv = document.createElement('div');
                optionDiv.className = 'avatar-option';
                optionDiv.setAttribute('data-url', avatarUrl);
                optionDiv.innerHTML = `<img src="${avatarUrl}" alt="Avatar">`;
                
                // THÊM XỬ LÝ LỖI TẢI ẢNH: Nếu ảnh không tải được, console.log lỗi
                const imgElement = optionDiv.querySelector('img');
                imgElement.onerror = () => {
                     console.error(`Lỗi tải hình ảnh từ: ${avatarUrl}`);
                     // Giữ nguyên alt text "avatar" để người dùng biết là hình bị lỗi
                };


                optionDiv.addEventListener('click', () => {
                    // Xóa trạng thái selected cũ
                    document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
                    
                    // Thiết lập trạng thái mới
                    optionDiv.classList.add('selected');
                    selectedAvatarUrl = avatarUrl;
                    confirmBtn.disabled = false;
                });
                
                grid.appendChild(optionDiv);
            });

            confirmBtn.addEventListener('click', handleAvatarSelection);
        }

        function handleAvatarSelection() {
            if (!selectedAvatarUrl) {
                alert('Vui lòng chọn một hình đại diện.');
                return;
            }
            
            // Lưu URL vào LocalStorage
            localStorage.setItem('userAvatarUrl', selectedAvatarUrl);

            alert('Hình đại diện đã được lưu! Vui lòng kiểm tra lại trang Hồ sơ.');
            
            // Quay lại trang trước
            window.history.back();
        }

    </script> 
</body>
</html>